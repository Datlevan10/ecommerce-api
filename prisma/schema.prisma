generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Shop {
  shopId       String   @id @default(cuid()) @map("shop_id")
  shopName     String   @map("shop_name")
  shopCode     String   @unique @map("shop_code")
  logoUrl      String?  @map("logo_url")
  bannerImages Json?    @map("banner_images")
  description  String?
  email        String
  phone        String
  websiteUrl   String?  @map("website_url")
  address      Json
  socialLinks  Json?    @map("social_links")
  currencyCode String   @default("USD") @map("currency_code")
  timezone     String   @default("UTC")
  language     String   @default("en")
  taxNumber    String?  @map("tax_number")
  businessName String?  @map("business_name")
  metadata     Json?
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@index([shopCode])
  @@index([isActive])
  @@map("shops")
}

model Customer {
  customerId      String            @id @default(cuid()) @map("customer_id")
  fullName        String            @map("full_name")
  email           String            @unique
  phone           String?
  passwordHash    String            @map("password_hash")
  avatarUrl       String?           @map("avatar_url")
  emailVerifiedAt DateTime?         @map("email_verified_at")
  status          CustomerStatus    @default(active)
  lastLoginAt     DateTime?         @map("last_login_at")
  refreshToken    String?           @map("refresh_token")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  deletedAt       DateTime?         @map("deleted_at")
  carts           Cart[]
  orders          Order[]
  favorites       ProductFavorite[]
  reviews         Review[]

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@map("customers")
}

model Admin {
  adminId      String    @id @default(cuid()) @map("admin_id")
  name         String
  email        String    @unique
  passwordHash String    @map("password_hash")
  role         AdminRole @default(admin)
  refreshToken String?   @map("refresh_token")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  @@index([email])
  @@index([role])
  @@map("admins")
}

model Staff {
  staffId      String    @id @default(cuid()) @map("staff_id")
  name         String
  email        String    @unique
  passwordHash String    @map("password_hash")
  role         StaffRole
  isActive     Boolean   @default(true) @map("is_active")
  refreshToken String?   @map("refresh_token")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@map("staffs")
}

model Category {
  categoryId   String     @id @default(cuid()) @map("category_id")
  categoryName String     @map("category_name")
  description  String?
  parentId     String?    @map("parent_id")
  slug         String     @unique
  imageUrl     String?    @map("image_url")
  isActive     Boolean    @default(true) @map("is_active")
  sortOrder    Int        @default(0) @map("sort_order")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  deletedAt    DateTime?  @map("deleted_at")
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [categoryId])
  children     Category[] @relation("CategoryHierarchy")
  products     Product[]

  @@index([parentId])
  @@index([slug])
  @@index([isActive])
  @@map("categories")
}

model Product {
  averageReview   Decimal           @default(0) @map("average_review") @db.Decimal(3, 1)
  categoryId      String            @map("category_id")
  color           Json
  createdAt       DateTime          @default(now()) @map("created_at")
  description     String
  newPrice        Decimal           @map("new_price") @db.Decimal(10, 2)
  note            String?
  oldPrice        Decimal?          @map("old_price") @db.Decimal(10, 2)
  productId       String            @id @default(cuid()) @map("product_id")
  productName     String            @map("product_name")
  quantityInStock Int?              @map("quantity_in_stock")
  size            Json
  totalReview     Int               @default(0) @map("total_review")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  variant         Json?
  image           Json
  deletedAt       DateTime?         @map("deleted_at")
  isActive        Boolean           @default(true) @map("is_active")
  cartDetails     CartDetail[]
  orderDetails    OrderDetail[]
  favorites       ProductFavorite[]
  category        Category          @relation(fields: [categoryId], references: [categoryId])
  reviews         Review[]

  @@index([categoryId])
  @@index([productName])
  @@index([newPrice])
  @@index([isActive])
  @@index([createdAt])
  @@map("products")
}

model Cart {
  cartId      String       @id @default(cuid()) @map("cart_id")
  customerId  String       @map("customer_id")
  status      CartStatus   @default(active)
  totalAmount Decimal      @default(0) @map("total_amount") @db.Decimal(10, 2)
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  cartDetails CartDetail[]
  customer    Customer     @relation(fields: [customerId], references: [customerId])

  @@unique([customerId, status])
  @@index([customerId])
  @@index([status])
  @@map("carts")
}

model CartDetail {
  cartDetailId  String   @id @default(cuid()) @map("cart_detail_id")
  cartId        String   @map("cart_id")
  productId     String   @map("product_id")
  quantity      Int
  selectedColor String?  @map("selected_color")
  selectedSize  String?  @map("selected_size")
  priceAtTime   Decimal  @map("price_at_time") @db.Decimal(10, 2)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  cart          Cart     @relation(fields: [cartId], references: [cartId], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [productId])

  @@unique([cartId, productId, selectedColor, selectedSize])
  @@index([cartId])
  @@index([productId])
  @@map("cart_details")
}

model Order {
  orderId         String        @id @default(cuid()) @map("order_id")
  customerId      String        @map("customer_id")
  orderCode       String        @unique @map("order_code")
  totalAmount     Decimal       @map("total_amount") @db.Decimal(10, 2)
  subtotal        Decimal       @default(0) @db.Decimal(10, 2)
  shippingFee     Decimal       @default(0) @map("shipping_fee") @db.Decimal(10, 2)
  discount        Decimal       @default(0) @db.Decimal(10, 2)
  paymentMethod   PaymentMethod @map("payment_method")
  paymentStatus   PaymentStatus @default(pending) @map("payment_status")
  orderStatus     OrderStatus   @default(pending) @map("order_status")
  shippingAddress Json          @map("shipping_address")
  note            String?
  processedAt     DateTime?     @map("processed_at")
  shippedAt       DateTime?     @map("shipped_at")
  completedAt     DateTime?     @map("completed_at")
  cancelledAt     DateTime?     @map("cancelled_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  orderDetails    OrderDetail[]
  customer        Customer      @relation(fields: [customerId], references: [customerId])

  @@index([customerId])
  @@index([orderCode])
  @@index([orderStatus])
  @@index([paymentStatus])
  @@index([createdAt])
  @@map("orders")
}

model OrderDetail {
  orderDetailId String   @id @default(cuid()) @map("order_detail_id")
  orderId       String   @map("order_id")
  productId     String   @map("product_id")
  productName   String   @map("product_name")
  quantity      Int
  price         Decimal  @db.Decimal(10, 2)
  selectedColor String?  @map("selected_color")
  selectedSize  String?  @map("selected_size")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  order         Order    @relation(fields: [orderId], references: [orderId])
  product       Product  @relation(fields: [productId], references: [productId])

  @@unique([orderId, productId, selectedColor, selectedSize])
  @@index([orderId])
  @@index([productId])
  @@map("order_details")
}

model ProductFavorite {
  favoriteId String   @id @default(cuid()) @map("favorite_id")
  customerId String   @map("customer_id")
  productId  String   @map("product_id")
  createdAt  DateTime @default(now()) @map("created_at")
  customer   Customer @relation(fields: [customerId], references: [customerId])
  product    Product  @relation(fields: [productId], references: [productId])

  @@unique([customerId, productId])
  @@index([customerId])
  @@index([productId])
  @@map("product_favorites")
}

model Review {
  reviewId   String    @id @default(cuid()) @map("review_id")
  productId  String    @map("product_id")
  customerId String    @map("customer_id")
  orderId    String?   @map("order_id")
  rating     Int
  comment    String?
  images     Json?
  isApproved Boolean   @default(false) @map("is_approved")
  approvedAt DateTime? @map("approved_at")
  approvedBy String?   @map("approved_by")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  customer   Customer  @relation(fields: [customerId], references: [customerId])
  product    Product   @relation(fields: [productId], references: [productId])

  @@unique([productId, customerId])
  @@index([productId])
  @@index([customerId])
  @@index([isApproved])
  @@index([rating])
  @@map("reviews")
}

model EmailVerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  email     String
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([token])
  @@index([email])
  @@map("email_verification_tokens")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  email     String
  userType  String   @map("user_type")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([token])
  @@index([email])
  @@map("password_reset_tokens")
}

enum CustomerStatus {
  active
  inactive
  banned

  @@map("customer_status")
}

enum AdminRole {
  super_admin
  admin

  @@map("admin_role")
}

enum StaffRole {
  manager
  support
  warehouse

  @@map("staff_role")
}

enum CartStatus {
  active
  converted
  abandoned

  @@map("cart_status")
}

enum PaymentMethod {
  cod
  bank_transfer
  stripe
  paypal

  @@map("payment_method")
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded

  @@map("payment_status")
}

enum OrderStatus {
  pending
  processing
  shipped
  completed
  cancelled

  @@map("order_status")
}
